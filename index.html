<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Phân tích danh mục - Nomini</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #F1F5F9;
      min-height: 100vh;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Giá coin hardcode - bổ sung thêm nhiều coin phổ biến
    const COIN_PRICES = {
      // Top coins
      BTC: 88230, ETH: 2926, BNB: 600, SOL: 124, XRP: 1.90,
      ADA: 0.35, DOGE: 0.12, DOT: 4.50, AVAX: 22, LINK: 15.80,
      MATIC: 0.32, UNI: 8.50, ATOM: 5.20, LTC: 69.60, ETC: 18,
      XLM: 0.21, TRX: 0.14, NEAR: 3.50, APT: 5.80, SUI: 1.44,
      
      // DeFi
      AAVE: 185, MKR: 1250, CRV: 0.55, LDO: 1.20, SNX: 1.80,
      COMP: 45, SUSHI: 0.80, YFI: 5500, BAL: 2.50, INCH: 0.25,
      
      // Layer 2
      ARB: 0.45, OP: 1.20, IMX: 1.10, STRK: 0.40, ZK: 0.12,
      MANTA: 0.80, BLAST: 0.02, BASE: 0.50,
      
      // AI & Infrastructure  
      FET: 1.10, RNDR: 4.80, GRT: 0.14, FIL: 3.80, AR: 12,
      OCEAN: 0.35, AGIX: 0.30, TAO: 280, AKT: 2.50,
      
      // Gaming & Metaverse
      SAND: 0.35, MANA: 0.32, AXS: 4.50, GALA: 0.02, ENJ: 0.18,
      ILV: 35, MAGIC: 0.40, IMX: 1.10, BEAM: 0.015,
      
      // Meme
      SHIB: 0.000012, PEPE: 0.0000095, WIF: 0.85, BONK: 0.000015,
      FLOKI: 0.00012, MEME: 0.015, DEGEN: 0.008,
      
      // Exchange tokens
      BNB: 600, OKB: 42, CRO: 0.08, KCS: 8.50, GT: 4.20, MX: 2.80,
      
      // Stablecoins
      USDT: 1.00, USDC: 1.00, DAI: 1.00, BUSD: 1.00, TUSD: 1.00,
      
      // Others
      HBAR: 0.11, EOS: 0.55, VET: 0.025, ALGO: 0.22, FTM: 0.45,
      EGLD: 25, FLOW: 0.50, KAVA: 0.45, INJ: 12.50, TIA: 3.20,
      SEI: 0.25, PYTH: 0.25, JTO: 2.20, JUP: 0.55, WLD: 1.80,
      STX: 1.20, ORDI: 25, RUNE: 3.20, CAKE: 1.80, GMT: 0.12,
      APE: 0.80, BLUR: 0.20, PENDLE: 3.50, ENS: 18, RPL: 18,
      SSV: 20, EIGEN: 3.20, ALT: 0.08, PIXEL: 0.15, PORTAL: 0.30,
      ETHFI: 1.50, REZ: 0.03, NOT: 0.005, LISTA: 0.35, ZRO: 3.50,
      RENDER: 4.80, KAS: 0.12, TON: 5.50, SUI: 1.44, BOME: 0.006,
      MEW: 0.003, POPCAT: 0.30, TURBO: 0.005, BRETT: 0.08,
    };

    const formatUSD = (value) => {
      if (value >= 1000000) {
        return '$' + (value / 1000000).toFixed(2) + 'M';
      } else if (value >= 1000) {
        return '$' + value.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
      } else if (value >= 1) {
        return '$' + value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      } else {
        return '$' + value.toFixed(6);
      }
    };

    const COLORS = ['#0891B2', '#8B5CF6', '#F59E0B', '#10B981', '#EC4899', '#6366F1', '#EF4444', '#14B8A6'];

    // Component Line Chart cho tổng danh mục (thứ tự mới: Hiện tại → KB1 → KB2)
    function TotalLineChart({ data }) {
      const chartRef = useRef(null);
      const canvasRef = useRef(null);

      useEffect(() => {
        if (chartRef.current) {
          chartRef.current.destroy();
        }

        const ctx = canvasRef.current.getContext('2d');
        chartRef.current = new Chart(ctx, {
          type: 'line',
          data: {
            labels: ['Hiện tại', 'Kịch bản 1', 'Kịch bản 2'],
            datasets: [{
              label: 'Giá trị danh mục',
              data: [data.totalCurrent, data.totalS1, data.totalS2],
              borderColor: '#0891B2',
              backgroundColor: 'rgba(8, 145, 178, 0.1)',
              borderWidth: 3,
              pointBackgroundColor: ['#0891B2', '#DC2626', '#16A34A'],
              pointBorderColor: ['#0891B2', '#DC2626', '#16A34A'],
              pointRadius: 8,
              pointHoverRadius: 10,
              fill: true,
              tension: 0.3
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  label: (context) => formatUSD(context.raw)
                }
              }
            },
            scales: {
              y: {
                beginAtZero: false,
                ticks: {
                  callback: (value) => {
                    if (value >= 1000000) return '$' + (value/1000000).toFixed(1) + 'M';
                    if (value >= 1000) return '$' + (value/1000).toFixed(1) + 'k';
                    return '$' + value;
                  }
                }
              }
            }
          }
        });

        return () => {
          if (chartRef.current) {
            chartRef.current.destroy();
          }
        };
      }, [data]);

      return <canvas ref={canvasRef} />;
    }

    // Component Pie Chart cho tỷ trọng - phiên bản đẹp hơn
    function PieChart({ data, title, titleColor }) {
      const chartRef = useRef(null);
      const canvasRef = useRef(null);

      useEffect(() => {
        if (chartRef.current) {
          chartRef.current.destroy();
        }

        const ctx = canvasRef.current.getContext('2d');
        chartRef.current = new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: data.map(d => d.coin),
            datasets: [{
              data: data.map(d => d.weight),
              backgroundColor: data.map((_, i) => COLORS[i % COLORS.length]),
              borderWidth: 3,
              borderColor: '#fff',
              hoverOffset: 8
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '40%',
            plugins: {
              legend: { display: false },
              tooltip: {
                backgroundColor: '#1E293B',
                titleFont: { size: 14, weight: 'bold' },
                bodyFont: { size: 13 },
                padding: 12,
                cornerRadius: 8,
                callbacks: {
                  label: (context) => `${context.label}: ${context.raw.toFixed(1)}%`
                }
              }
            }
          },
          plugins: [{
            id: 'datalabels',
            afterDraw: (chart) => {
              const ctx = chart.ctx;
              chart.data.datasets.forEach((dataset, i) => {
                const meta = chart.getDatasetMeta(i);
                meta.data.forEach((element, index) => {
                  const value = dataset.data[index];
                  if (value > 8) {
                    const { x, y } = element.tooltipPosition();
                    ctx.fillStyle = '#fff';
                    ctx.font = 'bold 11px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(value.toFixed(0) + '%', x, y);
                  }
                });
              });
            }
          }]
        });

        return () => {
          if (chartRef.current) {
            chartRef.current.destroy();
          }
        };
      }, [data]);

      return (
        <div style={{ textAlign: 'center' }}>
          <div style={{ 
            fontSize: '14px', 
            fontWeight: '700', 
            color: titleColor || '#64748B',
            marginBottom: '12px'
          }}>{title}</div>
          <div style={{ height: '180px' }}>
            <canvas ref={canvasRef} />
          </div>
        </div>
      );
    }

    // Component Column Chart cho từng coin (grouped bar)
    function CoinColumnChart({ analysis }) {
      const chartRef = useRef(null);
      const canvasRef = useRef(null);

      useEffect(() => {
        if (chartRef.current) {
          chartRef.current.destroy();
        }

        const ctx = canvasRef.current.getContext('2d');
        
        chartRef.current = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: analysis.map(a => a.coin),
            datasets: [
              {
                label: 'Hiện tại',
                data: analysis.map(a => a.currentValue),
                backgroundColor: '#0891B2',
                borderRadius: 4
              },
              {
                label: 'Kịch bản 1',
                data: analysis.map(a => a.scenario1Value),
                backgroundColor: '#DC2626',
                borderRadius: 4
              },
              {
                label: 'Kịch bản 2',
                data: analysis.map(a => a.scenario2Value),
                backgroundColor: '#16A34A',
                borderRadius: 4
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { 
                position: 'bottom',
                labels: { usePointStyle: true, padding: 20 }
              },
              tooltip: {
                callbacks: {
                  label: (context) => context.dataset.label + ': ' + formatUSD(context.raw)
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: (value) => {
                    if (value >= 1000000) return '$' + (value/1000000).toFixed(1) + 'M';
                    if (value >= 1000) return '$' + (value/1000).toFixed(1) + 'k';
                    return '$' + value;
                  }
                }
              }
            }
          }
        });

        return () => {
          if (chartRef.current) {
            chartRef.current.destroy();
          }
        };
      }, [analysis]);

      return <canvas ref={canvasRef} />;
    }

    function App() {
      const [step, setStep] = useState(0);
      const [coins, setCoins] = useState([]);
      const [tableData, setTableData] = useState([]);
      const [results, setResults] = useState(null);
      const [coinInput, setCoinInput] = useState('');
      const [error, setError] = useState('');

      const handleCoinSubmit = () => {
        const inputCoins = coinInput.toUpperCase().split(',').map(c => c.trim()).filter(c => c);
        const validCoins = inputCoins.filter(c => COIN_PRICES[c]);
        const invalidCoins = inputCoins.filter(c => !COIN_PRICES[c]);

        if (validCoins.length === 0) {
          setError('Không tìm thấy coin hợp lệ. Vui lòng nhập lại.');
          return;
        }

        if (invalidCoins.length > 0) {
          setError(`Không hỗ trợ: ${invalidCoins.join(', ')}. Tiếp tục với: ${validCoins.join(', ')}`);
        } else {
          setError('');
        }

        setCoins(validCoins);
        setTableData(validCoins.map(coin => ({
          coin,
          currentPrice: COIN_PRICES[coin],
          quantity: '',
          scenario1: '',
          scenario2: ''
        })));
        setStep(1);
      };

      const updateTableData = (index, field, value) => {
        const newData = [...tableData];
        newData[index][field] = value;
        setTableData(newData);
      };

      const handleAnalyze = () => {
        const isValid = tableData.every(row => 
          row.quantity && row.scenario1 && row.scenario2 &&
          !isNaN(parseFloat(row.quantity)) && 
          !isNaN(parseFloat(row.scenario1)) && 
          !isNaN(parseFloat(row.scenario2))
        );

        if (!isValid) {
          setError('Vui lòng điền đầy đủ số lượng và giá kịch bản cho tất cả coin.');
          return;
        }

        setError('');

        const analysis = tableData.map(row => {
          const qty = parseFloat(row.quantity);
          const currentPrice = row.currentPrice;
          const s1Price = parseFloat(row.scenario1);
          const s2Price = parseFloat(row.scenario2);

          const currentValue = qty * currentPrice;
          const s1Value = qty * s1Price;
          const s2Value = qty * s2Price;

          const s1Change = ((s1Price - currentPrice) / currentPrice) * 100;
          const s2Change = ((s2Price - currentPrice) / currentPrice) * 100;

          return {
            coin: row.coin,
            quantity: qty,
            currentPrice,
            scenario1Price: s1Price,
            scenario2Price: s2Price,
            currentValue,
            scenario1Value: s1Value,
            scenario2Value: s2Value,
            scenario1Change: s1Change,
            scenario2Change: s2Change
          };
        });

        const totalCurrent = analysis.reduce((sum, a) => sum + a.currentValue, 0);
        const totalS1 = analysis.reduce((sum, a) => sum + a.scenario1Value, 0);
        const totalS2 = analysis.reduce((sum, a) => sum + a.scenario2Value, 0);

        const totalS1Change = ((totalS1 - totalCurrent) / totalCurrent) * 100;
        const totalS2Change = ((totalS2 - totalCurrent) / totalCurrent) * 100;

        // Tính tỷ trọng cho pie charts
        const weightsCurrent = analysis.map(a => ({ coin: a.coin, weight: (a.currentValue / totalCurrent) * 100 }));
        const weightsS1 = analysis.map(a => ({ coin: a.coin, weight: (a.scenario1Value / totalS1) * 100 }));
        const weightsS2 = analysis.map(a => ({ coin: a.coin, weight: (a.scenario2Value / totalS2) * 100 }));

        setResults({
          analysis,
          totalCurrent,
          totalS1,
          totalS2,
          totalS1Change,
          totalS2Change,
          weightsCurrent,
          weightsS1,
          weightsS2
        });

        setStep(2);
      };

      const handleReset = () => {
        setStep(0);
        setCoins([]);
        setTableData([]);
        setResults(null);
        setCoinInput('');
        setError('');
      };

      return (
        <div style={{
          maxWidth: '800px',
          margin: '0 auto',
          padding: '20px',
          minHeight: '100vh'
        }}>
          {/* Header */}
          <div style={{
            background: 'linear-gradient(135deg, #0891B2 0%, #0E7490 100%)',
            borderRadius: '16px',
            padding: '24px',
            marginBottom: '20px',
            color: 'white',
            textAlign: 'center'
          }}>
            <h1 style={{ fontSize: '24px', fontWeight: 'bold', marginBottom: '8px' }}>
              Phân tích danh mục đầu tư
            </h1>
            <p style={{ fontSize: '14px', opacity: 0.9 }}>Nomini - Workshop Tool</p>
          </div>

          {/* Step 0: Nhập coin */}
          {step === 0 && (
            <div style={{
              background: 'white',
              borderRadius: '16px',
              padding: '24px',
              boxShadow: '0 2px 8px rgba(0,0,0,0.08)'
            }}>
              <h2 style={{ fontSize: '18px', fontWeight: '600', marginBottom: '16px', color: '#1E293B' }}>
                Bước 1: Nhập danh sách coin
              </h2>
              <p style={{ fontSize: '14px', color: '#64748B', marginBottom: '16px' }}>
                Nhập các mã coin, phân tách bằng dấu phẩy. Ví dụ: BTC, ETH, SOL
              </p>
              <input
                type="text"
                value={coinInput}
                onChange={(e) => setCoinInput(e.target.value)}
                onKeyPress={(e) => e.key === 'Enter' && handleCoinSubmit()}
                placeholder="BTC, ETH, SOL, ARB..."
                style={{
                  width: '100%',
                  padding: '14px 16px',
                  fontSize: '16px',
                  border: '2px solid #E2E8F0',
                  borderRadius: '12px',
                  outline: 'none',
                  marginBottom: '12px'
                }}
              />
              {error && (
                <p style={{ fontSize: '13px', color: '#DC2626', marginBottom: '12px' }}>{error}</p>
              )}
              <button
                onClick={handleCoinSubmit}
                style={{
                  width: '100%',
                  padding: '14px',
                  background: '#0891B2',
                  color: 'white',
                  border: 'none',
                  borderRadius: '12px',
                  fontSize: '16px',
                  fontWeight: '600',
                  cursor: 'pointer'
                }}
              >
                Tiếp tục
              </button>
            </div>
          )}

          {/* Step 1: Bảng nhập liệu */}
          {step === 1 && (
            <div style={{
              background: 'white',
              borderRadius: '16px',
              padding: '24px',
              boxShadow: '0 2px 8px rgba(0,0,0,0.08)'
            }}>
              <h2 style={{ fontSize: '18px', fontWeight: '600', marginBottom: '8px', color: '#1E293B' }}>
                Bước 2: Điền thông tin
              </h2>
              <p style={{ fontSize: '14px', color: '#64748B', marginBottom: '20px' }}>
                Nhập số lượng và giá cho 2 kịch bản
              </p>

              <div style={{ overflowX: 'auto' }}>
                <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: '14px' }}>
                  <thead>
                    <tr style={{ background: '#F8FAFC' }}>
                      <th style={{ padding: '12px 8px', textAlign: 'left', fontWeight: '600', color: '#64748B', borderBottom: '2px solid #E2E8F0' }}>Coin</th>
                      <th style={{ padding: '12px 8px', textAlign: 'right', fontWeight: '600', color: '#64748B', borderBottom: '2px solid #E2E8F0' }}>Giá hiện tại</th>
                      <th style={{ padding: '12px 8px', textAlign: 'center', fontWeight: '600', color: '#64748B', borderBottom: '2px solid #E2E8F0' }}>Số lượng</th>
                      <th style={{ padding: '12px 8px', textAlign: 'center', fontWeight: '600', color: '#64748B', borderBottom: '2px solid #E2E8F0' }}>Kịch bản 1</th>
                      <th style={{ padding: '12px 8px', textAlign: 'center', fontWeight: '600', color: '#64748B', borderBottom: '2px solid #E2E8F0' }}>Kịch bản 2</th>
                    </tr>
                  </thead>
                  <tbody>
                    {tableData.map((row, index) => (
                      <tr key={row.coin} style={{ borderBottom: '1px solid #F1F5F9' }}>
                        <td style={{ padding: '12px 8px' }}>
                          <span style={{
                            background: COLORS[index % COLORS.length],
                            color: 'white',
                            padding: '4px 10px',
                            borderRadius: '6px',
                            fontSize: '13px',
                            fontWeight: '600'
                          }}>{row.coin}</span>
                        </td>
                        <td style={{ padding: '12px 8px', textAlign: 'right', color: '#64748B' }}>
                          {formatUSD(row.currentPrice)}
                        </td>
                        <td style={{ padding: '8px 4px' }}>
                          <input
                            type="text"
                            value={row.quantity}
                            onChange={(e) => updateTableData(index, 'quantity', e.target.value)}
                            placeholder="0.00"
                            style={{
                              width: '100%',
                              maxWidth: '100px',
                              padding: '8px',
                              border: '1px solid #E2E8F0',
                              borderRadius: '8px',
                              textAlign: 'center',
                              fontSize: '14px'
                            }}
                          />
                        </td>
                        <td style={{ padding: '8px 4px' }}>
                          <input
                            type="text"
                            value={row.scenario1}
                            onChange={(e) => updateTableData(index, 'scenario1', e.target.value)}
                            placeholder="Giá KB1"
                            style={{
                              width: '100%',
                              maxWidth: '100px',
                              padding: '8px',
                              border: '1px solid #E2E8F0',
                              borderRadius: '8px',
                              textAlign: 'center',
                              fontSize: '14px'
                            }}
                          />
                        </td>
                        <td style={{ padding: '8px 4px' }}>
                          <input
                            type="text"
                            value={row.scenario2}
                            onChange={(e) => updateTableData(index, 'scenario2', e.target.value)}
                            placeholder="Giá KB2"
                            style={{
                              width: '100%',
                              maxWidth: '100px',
                              padding: '8px',
                              border: '1px solid #E2E8F0',
                              borderRadius: '8px',
                              textAlign: 'center',
                              fontSize: '14px'
                            }}
                          />
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>

              {error && (
                <p style={{ fontSize: '13px', color: '#DC2626', marginTop: '12px' }}>{error}</p>
              )}

              <div style={{ display: 'flex', gap: '12px', marginTop: '20px' }}>
                <button
                  onClick={() => setStep(0)}
                  style={{
                    flex: 1,
                    padding: '14px',
                    background: '#F1F5F9',
                    color: '#64748B',
                    border: 'none',
                    borderRadius: '12px',
                    fontSize: '16px',
                    fontWeight: '600',
                    cursor: 'pointer'
                  }}
                >
                  Quay lại
                </button>
                <button
                  onClick={handleAnalyze}
                  style={{
                    flex: 2,
                    padding: '14px',
                    background: '#0891B2',
                    color: 'white',
                    border: 'none',
                    borderRadius: '12px',
                    fontSize: '16px',
                    fontWeight: '600',
                    cursor: 'pointer'
                  }}
                >
                  Phân tích
                </button>
              </div>
            </div>
          )}

          {/* Step 2: Kết quả */}
          {step === 2 && results && (
            <div>
              {/* Tổng quan */}
              <div style={{
                background: 'white',
                borderRadius: '16px',
                padding: '24px',
                marginBottom: '16px',
                boxShadow: '0 2px 8px rgba(0,0,0,0.08)'
              }}>
                <h2 style={{ fontSize: '14px', fontWeight: '600', marginBottom: '16px', color: '#64748B', letterSpacing: '0.5px' }}>
                  DANH MỤC HIỆN TẠI
                </h2>
                <div style={{ fontSize: '32px', fontWeight: 'bold', color: '#1E293B', marginBottom: '20px' }}>
                  {formatUSD(results.totalCurrent)}
                </div>

                {results.analysis.map((item, i) => (
                  <div key={item.coin} style={{
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'center',
                    padding: '12px 0',
                    borderBottom: i < results.analysis.length - 1 ? '1px solid #F1F5F9' : 'none'
                  }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                      <span style={{
                        background: COLORS[i % COLORS.length],
                        color: 'white',
                        padding: '4px 10px',
                        borderRadius: '6px',
                        fontSize: '12px',
                        fontWeight: '600'
                      }}>{item.coin}</span>
                      <span style={{ color: '#64748B', fontSize: '13px' }}>
                        {item.quantity} × {formatUSD(item.currentPrice)}
                      </span>
                    </div>
                    <div style={{ textAlign: 'right' }}>
                      <div style={{ fontWeight: '600', color: '#1E293B' }}>{formatUSD(item.currentValue)}</div>
                      <div style={{ fontSize: '12px', color: '#64748B' }}>
                        {((item.currentValue / results.totalCurrent) * 100).toFixed(1)}%
                      </div>
                    </div>
                  </div>
                ))}
              </div>

              {/* Line Chart - Tổng danh mục */}
              <div style={{
                background: 'white',
                borderRadius: '16px',
                padding: '24px',
                marginBottom: '16px',
                boxShadow: '0 2px 8px rgba(0,0,0,0.08)'
              }}>
                <h2 style={{ fontSize: '14px', fontWeight: '600', marginBottom: '20px', color: '#64748B', letterSpacing: '0.5px' }}>
                  BIẾN ĐỘNG TỔNG DANH MỤC
                </h2>

                <div style={{ height: '250px', marginBottom: '20px' }}>
                  <TotalLineChart data={results} />
                </div>

                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '12px' }}>
                  <div style={{ background: '#F0FDFA', borderRadius: '12px', padding: '16px', textAlign: 'center' }}>
                    <div style={{ fontSize: '12px', color: '#0891B2', marginBottom: '4px' }}>Hiện tại</div>
                    <div style={{ fontSize: '18px', fontWeight: 'bold', color: '#0891B2' }}>{formatUSD(results.totalCurrent)}</div>
                    <div style={{ fontSize: '13px', color: '#0891B2' }}>Cơ sở</div>
                  </div>
                  <div style={{ background: results.totalS1Change >= 0 ? '#F0FDF4' : '#FEF2F2', borderRadius: '12px', padding: '16px', textAlign: 'center' }}>
                    <div style={{ fontSize: '12px', color: results.totalS1Change >= 0 ? '#16A34A' : '#DC2626', marginBottom: '4px' }}>Kịch bản 1</div>
                    <div style={{ fontSize: '18px', fontWeight: 'bold', color: results.totalS1Change >= 0 ? '#16A34A' : '#DC2626' }}>{formatUSD(results.totalS1)}</div>
                    <div style={{ fontSize: '13px', color: results.totalS1Change >= 0 ? '#16A34A' : '#DC2626' }}>{results.totalS1Change >= 0 ? '+' : ''}{results.totalS1Change.toFixed(1)}%</div>
                  </div>
                  <div style={{ background: results.totalS2Change >= 0 ? '#F0FDF4' : '#FEF2F2', borderRadius: '12px', padding: '16px', textAlign: 'center' }}>
                    <div style={{ fontSize: '12px', color: results.totalS2Change >= 0 ? '#16A34A' : '#DC2626', marginBottom: '4px' }}>Kịch bản 2</div>
                    <div style={{ fontSize: '18px', fontWeight: 'bold', color: results.totalS2Change >= 0 ? '#16A34A' : '#DC2626' }}>{formatUSD(results.totalS2)}</div>
                    <div style={{ fontSize: '13px', color: results.totalS2Change >= 0 ? '#16A34A' : '#DC2626' }}>{results.totalS2Change >= 0 ? '+' : ''}{results.totalS2Change.toFixed(1)}%</div>
                  </div>
                </div>
              </div>

              {/* Pie Charts - Tỷ trọng theo kịch bản */}
              <div style={{
                background: 'white',
                borderRadius: '16px',
                padding: '24px',
                marginBottom: '16px',
                boxShadow: '0 2px 8px rgba(0,0,0,0.08)',
                overflow: 'hidden'
              }}>
                <h2 style={{ fontSize: '14px', fontWeight: '600', marginBottom: '24px', color: '#64748B', letterSpacing: '0.5px' }}>
                  TỶ TRỌNG THEO KỊCH BẢN
                </h2>

                <div style={{ 
                  display: 'flex', 
                  justifyContent: 'space-between',
                  gap: '16px',
                  flexWrap: 'wrap'
                }}>
                  <div style={{ flex: '1 1 200px', minWidth: '200px', maxWidth: '250px' }}>
                    <PieChart data={results.weightsCurrent} title="Hiện tại" titleColor="#0891B2" />
                  </div>
                  <div style={{ flex: '1 1 200px', minWidth: '200px', maxWidth: '250px' }}>
                    <PieChart data={results.weightsS1} title="Kịch bản 1" titleColor="#DC2626" />
                  </div>
                  <div style={{ flex: '1 1 200px', minWidth: '200px', maxWidth: '250px' }}>
                    <PieChart data={results.weightsS2} title="Kịch bản 2" titleColor="#16A34A" />
                  </div>
                </div>

                {/* Legend */}
                <div style={{ 
                  display: 'flex', 
                  justifyContent: 'center', 
                  gap: '20px', 
                  marginTop: '24px', 
                  flexWrap: 'wrap',
                  padding: '16px',
                  background: '#F8FAFC',
                  borderRadius: '12px'
                }}>
                  {results.analysis.map((item, i) => (
                    <div key={item.coin} style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                      <div style={{ 
                        width: '14px', 
                        height: '14px', 
                        borderRadius: '4px', 
                        background: COLORS[i % COLORS.length],
                        boxShadow: '0 1px 3px rgba(0,0,0,0.2)'
                      }} />
                      <span style={{ fontSize: '13px', fontWeight: '600', color: '#334155' }}>{item.coin}</span>
                    </div>
                  ))}
                </div>
              </div>

              {/* Column Chart - Biến động từng coin */}
              <div style={{
                background: 'white',
                borderRadius: '16px',
                padding: '24px',
                marginBottom: '16px',
                boxShadow: '0 2px 8px rgba(0,0,0,0.08)'
              }}>
                <h2 style={{ fontSize: '14px', fontWeight: '600', marginBottom: '20px', color: '#64748B', letterSpacing: '0.5px' }}>
                  BIẾN ĐỘNG TỪNG COIN
                </h2>

                <div style={{ height: '300px', marginBottom: '20px' }}>
                  <CoinColumnChart analysis={results.analysis} />
                </div>

                {/* Bảng chi tiết */}
                <div style={{ overflowX: 'auto' }}>
                  <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: '13px' }}>
                    <thead>
                      <tr style={{ background: '#F8FAFC' }}>
                        <th style={{ padding: '10px 8px', textAlign: 'left', fontWeight: '600', color: '#64748B' }}>Coin</th>
                        <th style={{ padding: '10px 8px', textAlign: 'right', fontWeight: '600', color: '#0891B2' }}>Hiện tại</th>
                        <th style={{ padding: '10px 8px', textAlign: 'right', fontWeight: '600', color: '#DC2626' }}>KB1</th>
                        <th style={{ padding: '10px 8px', textAlign: 'right', fontWeight: '600', color: '#16A34A' }}>KB2</th>
                      </tr>
                    </thead>
                    <tbody>
                      {results.analysis.map((item, i) => (
                        <tr key={item.coin} style={{ borderBottom: '1px solid #F1F5F9' }}>
                          <td style={{ padding: '10px 8px' }}>
                            <span style={{
                              background: COLORS[i % COLORS.length],
                              color: 'white',
                              padding: '2px 8px',
                              borderRadius: '4px',
                              fontSize: '12px',
                              fontWeight: '600'
                            }}>{item.coin}</span>
                          </td>
                          <td style={{ padding: '10px 8px', textAlign: 'right' }}>
                            <div style={{ fontWeight: '600' }}>{formatUSD(item.currentValue)}</div>
                          </td>
                          <td style={{ padding: '10px 8px', textAlign: 'right' }}>
                            <div style={{ color: item.scenario1Change >= 0 ? '#16A34A' : '#DC2626' }}>{formatUSD(item.scenario1Value)}</div>
                            <div style={{ fontSize: '11px', color: item.scenario1Change >= 0 ? '#16A34A' : '#DC2626' }}>({item.scenario1Change >= 0 ? '+' : ''}{item.scenario1Change.toFixed(0)}%)</div>
                          </td>
                          <td style={{ padding: '10px 8px', textAlign: 'right' }}>
                            <div style={{ color: item.scenario2Change >= 0 ? '#16A34A' : '#DC2626' }}>{formatUSD(item.scenario2Value)}</div>
                            <div style={{ fontSize: '11px', color: item.scenario2Change >= 0 ? '#16A34A' : '#DC2626' }}>({item.scenario2Change >= 0 ? '+' : ''}{item.scenario2Change.toFixed(0)}%)</div>
                          </td>
                        </tr>
                      ))}
                      <tr style={{ background: '#F8FAFC', fontWeight: '600' }}>
                        <td style={{ padding: '10px 8px' }}>TỔNG</td>
                        <td style={{ padding: '10px 8px', textAlign: 'right', color: '#0891B2' }}>{formatUSD(results.totalCurrent)}</td>
                        <td style={{ padding: '10px 8px', textAlign: 'right', color: results.totalS1Change >= 0 ? '#16A34A' : '#DC2626' }}>{formatUSD(results.totalS1)}</td>
                        <td style={{ padding: '10px 8px', textAlign: 'right', color: results.totalS2Change >= 0 ? '#16A34A' : '#DC2626' }}>{formatUSD(results.totalS2)}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              {/* So sánh 2 kịch bản */}
              <div style={{
                background: 'white',
                borderRadius: '16px',
                padding: '24px',
                marginBottom: '16px',
                boxShadow: '0 2px 8px rgba(0,0,0,0.08)'
              }}>
                <h2 style={{ fontSize: '14px', fontWeight: '600', marginBottom: '16px', color: '#64748B', letterSpacing: '0.5px' }}>
                  SO SÁNH 2 KỊCH BẢN
                </h2>

                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '12px' }}>
                  <div style={{
                    background: results.totalS1Change >= 0 ? '#F0FDF4' : '#FEF2F2',
                    borderRadius: '12px',
                    padding: '20px',
                    textAlign: 'center'
                  }}>
                    <div style={{ fontSize: '12px', color: '#64748B', marginBottom: '8px' }}>Kịch bản 1</div>
                    <div style={{ fontSize: '24px', fontWeight: 'bold', color: results.totalS1Change >= 0 ? '#16A34A' : '#DC2626' }}>
                      {results.totalS1Change >= 0 ? '+' : ''}{formatUSD(results.totalS1 - results.totalCurrent)}
                    </div>
                    <div style={{ fontSize: '13px', color: results.totalS1Change >= 0 ? '#16A34A' : '#DC2626', marginTop: '4px' }}>
                      {results.totalS1Change >= 0 ? '+' : ''}{results.totalS1Change.toFixed(1)}%
                    </div>
                  </div>

                  <div style={{
                    background: results.totalS2Change >= 0 ? '#F0FDF4' : '#FEF2F2',
                    borderRadius: '12px',
                    padding: '20px',
                    textAlign: 'center'
                  }}>
                    <div style={{ fontSize: '12px', color: '#64748B', marginBottom: '8px' }}>Kịch bản 2</div>
                    <div style={{ fontSize: '24px', fontWeight: 'bold', color: results.totalS2Change >= 0 ? '#16A34A' : '#DC2626' }}>
                      {results.totalS2Change >= 0 ? '+' : ''}{formatUSD(results.totalS2 - results.totalCurrent)}
                    </div>
                    <div style={{ fontSize: '13px', color: results.totalS2Change >= 0 ? '#16A34A' : '#DC2626', marginTop: '4px' }}>
                      {results.totalS2Change >= 0 ? '+' : ''}{results.totalS2Change.toFixed(1)}%
                    </div>
                  </div>

                  <div style={{
                    background: '#F8FAFC',
                    borderRadius: '12px',
                    padding: '20px',
                    textAlign: 'center'
                  }}>
                    <div style={{ fontSize: '12px', color: '#64748B', marginBottom: '8px' }}>Chênh lệch</div>
                    <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#1E293B' }}>
                      {formatUSD(Math.abs(results.totalS2 - results.totalS1))}
                    </div>
                    <div style={{ fontSize: '13px', color: '#64748B', marginTop: '4px' }}>
                      {Math.abs(results.totalS2Change - results.totalS1Change).toFixed(1)}%
                    </div>
                  </div>
                </div>
              </div>

              {/* Nút làm lại */}
              <button
                onClick={handleReset}
                style={{
                  width: '100%',
                  padding: '16px',
                  background: '#1E293B',
                  color: 'white',
                  border: 'none',
                  borderRadius: '12px',
                  fontSize: '16px',
                  fontWeight: '600',
                  cursor: 'pointer'
                }}
              >
                Phân tích danh mục mới
              </button>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
