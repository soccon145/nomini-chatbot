<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ph√¢n t√≠ch danh m·ª•c - Nomini</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #F1F5F9;
      min-height: 100vh;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Mapping t·ª´ symbol sang CoinGecko ID
    const COIN_IDS = {
      BTC: 'bitcoin', ETH: 'ethereum', BNB: 'binancecoin', SOL: 'solana', XRP: 'ripple',
      ADA: 'cardano', DOGE: 'dogecoin', DOT: 'polkadot', AVAX: 'avalanche-2', LINK: 'chainlink',
      MATIC: 'matic-network', POL: 'matic-network', UNI: 'uniswap', ATOM: 'cosmos', LTC: 'litecoin', 
      ETC: 'ethereum-classic', XLM: 'stellar', TRX: 'tron', NEAR: 'near', APT: 'aptos', SUI: 'sui',
      AAVE: 'aave', MKR: 'maker', CRV: 'curve-dao-token', LDO: 'lido-dao', SNX: 'havven',
      COMP: 'compound-governance-token', SUSHI: 'sushi', YFI: 'yearn-finance', BAL: 'balancer',
      ARB: 'arbitrum', OP: 'optimism', IMX: 'immutable-x', STRK: 'starknet', ZK: 'zksync',
      FET: 'fetch-ai', RNDR: 'render-token', GRT: 'the-graph', FIL: 'filecoin', AR: 'arweave',
      OCEAN: 'ocean-protocol', TAO: 'bittensor', AKT: 'akash-network',
      SAND: 'the-sandbox', MANA: 'decentraland', AXS: 'axie-infinity', GALA: 'gala', ENJ: 'enjincoin',
      ILV: 'illuvium', MAGIC: 'magic',
      SHIB: 'shiba-inu', PEPE: 'pepe', WIF: 'dogwifcoin', BONK: 'bonk', FLOKI: 'floki',
      OKB: 'okb', CRO: 'crypto-com-chain', KCS: 'kucoin-shares', GT: 'gate-token',
      USDT: 'tether', USDC: 'usd-coin', DAI: 'dai', BUSD: 'binance-usd', TUSD: 'true-usd',
      HBAR: 'hedera-hashgraph', EOS: 'eos', VET: 'vechain', ALGO: 'algorand', FTM: 'fantom',
      EGLD: 'elrond-erd-2', FLOW: 'flow', KAVA: 'kava', INJ: 'injective-protocol', TIA: 'celestia',
      SEI: 'sei-network', PYTH: 'pyth-network', JTO: 'jito-governance-token', JUP: 'jupiter-exchange-solana', 
      WLD: 'worldcoin-wld', STX: 'blockstack', ORDI: 'ordinals', RUNE: 'thorchain', CAKE: 'pancakeswap-token', 
      GMT: 'stepn', APE: 'apecoin', BLUR: 'blur', PENDLE: 'pendle', ENS: 'ethereum-name-service', 
      RPL: 'rocket-pool', SSV: 'ssv-network', TON: 'the-open-network', KAS: 'kaspa',
      RENDER: 'render-token', NOT: 'notcoin', WEN: 'wen-4', POPCAT: 'popcat', TURBO: 'turbo',
      BRETT: 'brett', MEW: 'cat-in-a-dogs-world', BOME: 'book-of-meme',
    };

    // Alias mapping - cho ph√©p nh·∫≠p t√™n kh√°c
    const SYMBOL_ALIASES = {
      'BITCOIN': 'BTC', 'ETHEREUM': 'ETH', 'SOLANA': 'SOL', 'CARDANO': 'ADA',
      'DOGECOIN': 'DOGE', 'POLKADOT': 'DOT', 'POLYGON': 'MATIC', 'CHAINLINK': 'LINK',
      'AVALANCHE': 'AVAX', 'COSMOS': 'ATOM', 'LITECOIN': 'LTC', 'STELLAR': 'XLM',
      'RIPPLE': 'XRP', 'TRON': 'TRX', 'UNISWAP': 'UNI', 'AAVE': 'AAVE',
      'ARBITRUM': 'ARB', 'OPTIMISM': 'OP', 'FILECOIN': 'FIL', 'RENDER': 'RNDR',
      'SANDBOX': 'SAND', 'DECENTRALAND': 'MANA', 'AXIE': 'AXS', 'TONCOIN': 'TON',
      'KASPA': 'KAS', 'FANTOM': 'FTM', 'ALGORAND': 'ALGO', 'VECHAIN': 'VET',
    };

    // Gi√° backup n·∫øu API fail
    const FALLBACK_PRICES = {
      BTC: 96000, ETH: 2700, BNB: 600, SOL: 200, XRP: 2.50,
      ADA: 0.80, DOGE: 0.25, DOT: 5.50, AVAX: 28, LINK: 18,
      MATIC: 0.35, UNI: 9, ATOM: 5.50, LTC: 100, ETC: 22,
      XLM: 0.35, TRX: 0.22, NEAR: 4, APT: 7, SUI: 3.50,
      AAVE: 250, MKR: 1400, CRV: 0.60, LDO: 1.50, SNX: 2,
      ARB: 0.55, OP: 1.30, IMX: 1.20, FET: 1.20, RNDR: 6,
      GRT: 0.18, FIL: 4, AR: 15, TAO: 400, SAND: 0.40,
      MANA: 0.38, AXS: 5, GALA: 0.03, SHIB: 0.000015, PEPE: 0.00001,
      WIF: 1.20, BONK: 0.00002, FLOKI: 0.00015, TON: 4, KAS: 0.12,
      INJ: 18, TIA: 4, SEI: 0.35, HBAR: 0.25, FTM: 0.60,
      ALGO: 0.30, VET: 0.04, USDT: 1, USDC: 1, DAI: 1,
    };

    // Chu·∫©n h√≥a symbol (x·ª≠ l√Ω alias)
    const normalizeSymbol = (input) => {
      const upper = input.toUpperCase().trim();
      return SYMBOL_ALIASES[upper] || upper;
    };

    // H√†m g·ªçi API CoinGecko v·ªõi fallback
    const fetchCoinPrices = async (symbols) => {
      const ids = symbols.map(s => COIN_IDS[s]).filter(Boolean);
      if (ids.length === 0) return {};
      
      try {
        const response = await fetch(
          `https://api.coingecko.com/api/v3/simple/price?ids=${ids.join(',')}&vs_currencies=usd`,
          { signal: AbortSignal.timeout(10000) } // Timeout 10s
        );
        
        if (!response.ok) {
          throw new Error('API response not ok');
        }
        
        const data = await response.json();
        
        // Chuy·ªÉn ƒë·ªïi t·ª´ CoinGecko ID v·ªÅ symbol
        const prices = {};
        symbols.forEach(symbol => {
          const id = COIN_IDS[symbol];
          if (id && data[id]) {
            prices[symbol] = data[id].usd;
          } else if (FALLBACK_PRICES[symbol]) {
            // D√πng gi√° backup n·∫øu API kh√¥ng tr·∫£ v·ªÅ
            prices[symbol] = FALLBACK_PRICES[symbol];
          }
        });
        return prices;
      } catch (error) {
        console.error('API Error:', error);
        // N·∫øu API fail ho√†n to√†n, d√πng gi√° backup
        const prices = {};
        symbols.forEach(symbol => {
          if (FALLBACK_PRICES[symbol]) {
            prices[symbol] = FALLBACK_PRICES[symbol];
          }
        });
        return prices;
      }
    };

    const formatUSD = (value) => {
      if (value >= 1000000) {
        return '$' + (value / 1000000).toFixed(2) + 'M';
      } else if (value >= 1000) {
        return '$' + value.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
      } else if (value >= 1) {
        return '$' + value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      } else {
        return '$' + value.toFixed(6);
      }
    };

    const COLORS = ['#0891B2', '#8B5CF6', '#F59E0B', '#10B981', '#EC4899', '#6366F1', '#EF4444', '#14B8A6'];

    // Component Line Chart cho t·ªïng danh m·ª•c (th·ª© t·ª± m·ªõi: Hi·ªán t·∫°i ‚Üí KB1 ‚Üí KB2)
    function TotalLineChart({ data }) {
      const chartRef = useRef(null);
      const canvasRef = useRef(null);

      useEffect(() => {
        if (chartRef.current) {
          chartRef.current.destroy();
        }

        const ctx = canvasRef.current.getContext('2d');
        chartRef.current = new Chart(ctx, {
          type: 'line',
          data: {
            labels: ['Hi·ªán t·∫°i', 'K·ªãch b·∫£n 1', 'K·ªãch b·∫£n 2'],
            datasets: [{
              label: 'Gi√° tr·ªã danh m·ª•c',
              data: [data.totalCurrent, data.totalS1, data.totalS2],
              borderColor: '#0891B2',
              backgroundColor: 'rgba(8, 145, 178, 0.1)',
              borderWidth: 3,
              pointBackgroundColor: ['#0891B2', '#DC2626', '#16A34A'],
              pointBorderColor: ['#0891B2', '#DC2626', '#16A34A'],
              pointRadius: 8,
              pointHoverRadius: 10,
              fill: true,
              tension: 0.3
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  label: (context) => formatUSD(context.raw)
                }
              }
            },
            scales: {
              y: {
                beginAtZero: false,
                ticks: {
                  callback: (value) => {
                    if (value >= 1000000) return '$' + (value/1000000).toFixed(1) + 'M';
                    if (value >= 1000) return '$' + (value/1000).toFixed(1) + 'k';
                    return '$' + value;
                  }
                }
              }
            }
          }
        });

        return () => {
          if (chartRef.current) {
            chartRef.current.destroy();
          }
        };
      }, [data]);

      return <canvas ref={canvasRef} />;
    }

    // Component Pie Chart cho t·ª∑ tr·ªçng - phi√™n b·∫£n ƒë·∫πp h∆°n
    function PieChart({ data, title, titleColor }) {
      const chartRef = useRef(null);
      const canvasRef = useRef(null);

      useEffect(() => {
        if (chartRef.current) {
          chartRef.current.destroy();
        }

        const ctx = canvasRef.current.getContext('2d');
        chartRef.current = new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: data.map(d => d.coin),
            datasets: [{
              data: data.map(d => d.weight),
              backgroundColor: data.map((_, i) => COLORS[i % COLORS.length]),
              borderWidth: 3,
              borderColor: '#fff',
              hoverOffset: 8
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '40%',
            plugins: {
              legend: { display: false },
              tooltip: {
                backgroundColor: '#1E293B',
                titleFont: { size: 14, weight: 'bold' },
                bodyFont: { size: 13 },
                padding: 12,
                cornerRadius: 8,
                callbacks: {
                  label: (context) => `${context.label}: ${context.raw.toFixed(1)}%`
                }
              }
            }
          },
          plugins: [{
            id: 'datalabels',
            afterDraw: (chart) => {
              const ctx = chart.ctx;
              chart.data.datasets.forEach((dataset, i) => {
                const meta = chart.getDatasetMeta(i);
                meta.data.forEach((element, index) => {
                  const value = dataset.data[index];
                  if (value > 8) {
                    const { x, y } = element.tooltipPosition();
                    ctx.fillStyle = '#fff';
                    ctx.font = 'bold 11px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(value.toFixed(0) + '%', x, y);
                  }
                });
              });
            }
          }]
        });

        return () => {
          if (chartRef.current) {
            chartRef.current.destroy();
          }
        };
      }, [data]);

      return (
        <div style={{ textAlign: 'center' }}>
          <div style={{ 
            fontSize: '14px', 
            fontWeight: '700', 
            color: titleColor || '#64748B',
            marginBottom: '12px'
          }}>{title}</div>
          <div style={{ height: '180px' }}>
            <canvas ref={canvasRef} />
          </div>
        </div>
      );
    }

    // Component Column Chart cho t·ª´ng coin (grouped bar)
    function CoinColumnChart({ analysis }) {
      const chartRef = useRef(null);
      const canvasRef = useRef(null);

      useEffect(() => {
        if (chartRef.current) {
          chartRef.current.destroy();
        }

        const ctx = canvasRef.current.getContext('2d');
        
        chartRef.current = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: analysis.map(a => a.coin),
            datasets: [
              {
                label: 'Hi·ªán t·∫°i',
                data: analysis.map(a => a.currentValue),
                backgroundColor: '#0891B2',
                borderRadius: 4
              },
              {
                label: 'K·ªãch b·∫£n 1',
                data: analysis.map(a => a.scenario1Value),
                backgroundColor: '#DC2626',
                borderRadius: 4
              },
              {
                label: 'K·ªãch b·∫£n 2',
                data: analysis.map(a => a.scenario2Value),
                backgroundColor: '#16A34A',
                borderRadius: 4
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { 
                position: 'bottom',
                labels: { usePointStyle: true, padding: 20 }
              },
              tooltip: {
                callbacks: {
                  label: (context) => context.dataset.label + ': ' + formatUSD(context.raw)
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: (value) => {
                    if (value >= 1000000) return '$' + (value/1000000).toFixed(1) + 'M';
                    if (value >= 1000) return '$' + (value/1000).toFixed(1) + 'k';
                    return '$' + value;
                  }
                }
              }
            }
          }
        });

        return () => {
          if (chartRef.current) {
            chartRef.current.destroy();
          }
        };
      }, [analysis]);

      return <canvas ref={canvasRef} />;
    }

    function App() {
      const [step, setStep] = useState(0);
      const [coins, setCoins] = useState([]);
      const [tableData, setTableData] = useState([]);
      const [results, setResults] = useState(null);
      const [coinInput, setCoinInput] = useState('');
      const [error, setError] = useState('');

      const [loading, setLoading] = useState(false);

      const handleCoinSubmit = async () => {
        // Chu·∫©n h√≥a input (x·ª≠ l√Ω alias nh∆∞ BITCOIN ‚Üí BTC)
        const inputCoins = coinInput.split(',')
          .map(c => normalizeSymbol(c))
          .filter(c => c);
        
        const validCoins = inputCoins.filter(c => COIN_IDS[c]);
        const invalidCoins = inputCoins.filter(c => !COIN_IDS[c]);

        if (validCoins.length === 0) {
          setError('Kh√¥ng t√¨m th·∫•y coin h·ª£p l·ªá. Vui l√≤ng nh·∫≠p l·∫°i.');
          return;
        }

        if (invalidCoins.length > 0) {
          setError(`Kh√¥ng h·ªó tr·ª£: ${invalidCoins.join(', ')}. Ti·∫øp t·ª•c v·ªõi: ${validCoins.join(', ')}`);
        } else {
          setError('');
        }

        // G·ªçi API l·∫•y gi√°
        setLoading(true);
        const prices = await fetchCoinPrices(validCoins);
        setLoading(false);

        // Ki·ªÉm tra coin n√†o kh√¥ng l·∫•y ƒë∆∞·ª£c gi√°
        const coinsWithPrice = validCoins.filter(c => prices[c]);
        const coinsWithoutPrice = validCoins.filter(c => !prices[c]);

        if (coinsWithoutPrice.length > 0) {
          setError(prev => prev + ` Kh√¥ng l·∫•y ƒë∆∞·ª£c gi√°: ${coinsWithoutPrice.join(', ')}`);
        }

        if (coinsWithPrice.length === 0) {
          setError('Kh√¥ng l·∫•y ƒë∆∞·ª£c gi√° t·ª´ API. Vui l√≤ng th·ª≠ l·∫°i.');
          return;
        }

        setCoins(coinsWithPrice);
        setTableData(coinsWithPrice.map(coin => ({
          coin,
          currentPrice: prices[coin],
          quantity: '',
          scenario1: '',
          scenario2: ''
        })));
        setStep(1);
      };

      const updateTableData = (index, field, value) => {
        const newData = [...tableData];
        newData[index][field] = value;
        setTableData(newData);
      };

      const handleAnalyze = () => {
        const isValid = tableData.every(row => 
          row.quantity && row.scenario1 && row.scenario2 &&
          !isNaN(parseFloat(row.quantity)) && 
          !isNaN(parseFloat(row.scenario1)) && 
          !isNaN(parseFloat(row.scenario2))
        );

        if (!isValid) {
          setError('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß s·ªë l∆∞·ª£ng v√† gi√° k·ªãch b·∫£n cho t·∫•t c·∫£ coin.');
          return;
        }

        setError('');

        const analysis = tableData.map(row => {
          const qty = parseFloat(row.quantity);
          const currentPrice = row.currentPrice;
          const s1Price = parseFloat(row.scenario1);
          const s2Price = parseFloat(row.scenario2);

          const currentValue = qty * currentPrice;
          const s1Value = qty * s1Price;
          const s2Value = qty * s2Price;

          const s1Change = ((s1Price - currentPrice) / currentPrice) * 100;
          const s2Change = ((s2Price - currentPrice) / currentPrice) * 100;

          return {
            coin: row.coin,
            quantity: qty,
            currentPrice,
            scenario1Price: s1Price,
            scenario2Price: s2Price,
            currentValue,
            scenario1Value: s1Value,
            scenario2Value: s2Value,
            scenario1Change: s1Change,
            scenario2Change: s2Change
          };
        });

        const totalCurrent = analysis.reduce((sum, a) => sum + a.currentValue, 0);
        const totalS1 = analysis.reduce((sum, a) => sum + a.scenario1Value, 0);
        const totalS2 = analysis.reduce((sum, a) => sum + a.scenario2Value, 0);

        const totalS1Change = ((totalS1 - totalCurrent) / totalCurrent) * 100;
        const totalS2Change = ((totalS2 - totalCurrent) / totalCurrent) * 100;

        // T√≠nh t·ª∑ tr·ªçng cho pie charts
        const weightsCurrent = analysis.map(a => ({ coin: a.coin, weight: (a.currentValue / totalCurrent) * 100 }));
        const weightsS1 = analysis.map(a => ({ coin: a.coin, weight: (a.scenario1Value / totalS1) * 100 }));
        const weightsS2 = analysis.map(a => ({ coin: a.coin, weight: (a.scenario2Value / totalS2) * 100 }));

        setResults({
          analysis,
          totalCurrent,
          totalS1,
          totalS2,
          totalS1Change,
          totalS2Change,
          weightsCurrent,
          weightsS1,
          weightsS2
        });

        setStep(2);
      };

      const handleReset = () => {
        setStep(0);
        setCoins([]);
        setTableData([]);
        setResults(null);
        setCoinInput('');
        setError('');
      };

      return (
        <div style={{
          maxWidth: '800px',
          margin: '0 auto',
          padding: '20px',
          minHeight: '100vh'
        }}>
          {/* Header */}
          <div style={{
            background: 'linear-gradient(135deg, #0891B2 0%, #0E7490 100%)',
            borderRadius: '16px',
            padding: '24px',
            marginBottom: '20px',
            color: 'white',
            textAlign: 'center'
          }}>
            <h1 style={{ fontSize: '24px', fontWeight: 'bold', marginBottom: '8px' }}>
              Ph√¢n t√≠ch danh m·ª•c ƒë·∫ßu t∆∞
            </h1>
            <p style={{ fontSize: '14px', opacity: 0.9 }}>Nomini - Workshop Tool</p>
          </div>

          {/* Step Indicator */}
          <div style={{
            display: 'flex',
            justifyContent: 'center',
            gap: '8px',
            marginBottom: '20px'
          }}>
            {[0, 1, 2].map((s) => (
              <div key={s} style={{
                display: 'flex',
                alignItems: 'center',
                gap: '8px'
              }}>
                <div style={{
                  width: '32px',
                  height: '32px',
                  borderRadius: '50%',
                  background: step >= s ? '#0891B2' : '#E2E8F0',
                  color: step >= s ? 'white' : '#94A3B8',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  fontSize: '14px',
                  fontWeight: '600'
                }}>
                  {s + 1}
                </div>
                {s < 2 && (
                  <div style={{
                    width: '40px',
                    height: '3px',
                    background: step > s ? '#0891B2' : '#E2E8F0',
                    borderRadius: '2px'
                  }} />
                )}
              </div>
            ))}
          </div>

          {/* Step 0: Nh·∫≠p coin */}
          {step === 0 && (
            <div style={{
              background: 'white',
              borderRadius: '16px',
              padding: '24px',
              boxShadow: '0 2px 8px rgba(0,0,0,0.08)'
            }}>
              <h2 style={{ fontSize: '18px', fontWeight: '600', marginBottom: '8px', color: '#1E293B' }}>
                B∆∞·ªõc 1: Nh·∫≠p danh s√°ch coin
              </h2>
              <p style={{ fontSize: '14px', color: '#64748B', marginBottom: '16px' }}>
                Nh·∫≠p c√°c m√£ coin b·∫°n ƒëang n·∫Øm gi·ªØ, ph√¢n t√°ch b·∫±ng d·∫•u ph·∫©y
              </p>
              
              {/* V√≠ d·ª• m·∫´u */}
              <div style={{ marginBottom: '16px' }}>
                <span style={{ fontSize: '13px', color: '#64748B' }}>V√≠ d·ª•: </span>
                <button
                  onClick={() => setCoinInput('BTC, ETH, SOL, ARB, DOGE')}
                  style={{
                    background: '#F1F5F9',
                    border: 'none',
                    padding: '4px 10px',
                    borderRadius: '6px',
                    fontSize: '13px',
                    color: '#0891B2',
                    cursor: 'pointer',
                    marginRight: '8px'
                  }}
                >
                  BTC, ETH, SOL, ARB, DOGE
                </button>
                <button
                  onClick={() => setCoinInput('BTC, ETH, ADA, DOT, LDO')}
                  style={{
                    background: '#F1F5F9',
                    border: 'none',
                    padding: '4px 10px',
                    borderRadius: '6px',
                    fontSize: '13px',
                    color: '#0891B2',
                    cursor: 'pointer'
                  }}
                >
                  BTC, ETH, ADA, DOT, LDO
                </button>
              </div>

              <input
                type="text"
                value={coinInput}
                onChange={(e) => setCoinInput(e.target.value)}
                onKeyPress={(e) => e.key === 'Enter' && handleCoinSubmit()}
                placeholder="BTC, ETH, SOL, ARB..."
                style={{
                  width: '100%',
                  padding: '14px 16px',
                  fontSize: '16px',
                  border: '2px solid #E2E8F0',
                  borderRadius: '12px',
                  outline: 'none',
                  marginBottom: '12px'
                }}
              />
              {error && (
                <p style={{ fontSize: '13px', color: '#DC2626', marginBottom: '12px' }}>{error}</p>
              )}
              <button
                onClick={handleCoinSubmit}
                disabled={loading}
                style={{
                  width: '100%',
                  padding: '14px',
                  background: loading ? '#94A3B8' : '#0891B2',
                  color: 'white',
                  border: 'none',
                  borderRadius: '12px',
                  fontSize: '16px',
                  fontWeight: '600',
                  cursor: loading ? 'not-allowed' : 'pointer'
                }}
              >
                {loading ? 'ƒêang l·∫•y gi√°...' : 'Ti·∫øp t·ª•c'}
              </button>
            </div>
          )}

          {/* Step 1: B·∫£ng nh·∫≠p li·ªáu */}
          {step === 1 && (
            <div style={{
              background: 'white',
              borderRadius: '16px',
              padding: '24px',
              boxShadow: '0 2px 8px rgba(0,0,0,0.08)'
            }}>
              <h2 style={{ fontSize: '18px', fontWeight: '600', marginBottom: '8px', color: '#1E293B' }}>
                B∆∞·ªõc 2: ƒêi·ªÅn th√¥ng tin danh m·ª•c
              </h2>
              <p style={{ fontSize: '14px', color: '#64748B', marginBottom: '8px' }}>
                Nh·∫≠p s·ªë l∆∞·ª£ng coin b·∫°n ƒëang c√≥ v√† gi√° d·ª± ki·∫øn cho 2 k·ªãch b·∫£n
              </p>
              
              {/* Gi·∫£i th√≠ch k·ªãch b·∫£n */}
              <div style={{
                background: '#F0FDFA',
                borderRadius: '8px',
                padding: '12px 16px',
                marginBottom: '20px',
                fontSize: '13px',
                color: '#0E7490'
              }}>
                <strong>üí° G·ª£i √Ω:</strong> K·ªãch b·∫£n 1 & 2 c√≥ th·ªÉ l√† m·ª©c h·ªó tr·ª£/kh√°ng c·ª±, ho·∫∑c gi√° trong tr∆∞·ªùng h·ª£p th·ªã tr∆∞·ªùng tƒÉng/gi·∫£m
              </div>

              <div style={{ overflowX: 'auto' }}>
                <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: '14px' }}>
                  <thead>
                    <tr style={{ background: '#F8FAFC' }}>
                      <th style={{ padding: '12px 8px', textAlign: 'left', fontWeight: '600', color: '#64748B', borderBottom: '2px solid #E2E8F0' }}>Coin</th>
                      <th style={{ padding: '12px 8px', textAlign: 'right', fontWeight: '600', color: '#64748B', borderBottom: '2px solid #E2E8F0' }}>Gi√° hi·ªán t·∫°i</th>
                      <th style={{ padding: '12px 8px', textAlign: 'center', fontWeight: '600', color: '#64748B', borderBottom: '2px solid #E2E8F0' }}>S·ªë l∆∞·ª£ng</th>
                      <th style={{ padding: '12px 8px', textAlign: 'center', fontWeight: '600', color: '#64748B', borderBottom: '2px solid #E2E8F0' }}>K·ªãch b·∫£n 1</th>
                      <th style={{ padding: '12px 8px', textAlign: 'center', fontWeight: '600', color: '#64748B', borderBottom: '2px solid #E2E8F0' }}>K·ªãch b·∫£n 2</th>
                    </tr>
                  </thead>
                  <tbody>
                    {tableData.map((row, index) => (
                      <tr key={row.coin} style={{ borderBottom: '1px solid #F1F5F9' }}>
                        <td style={{ padding: '12px 8px' }}>
                          <span style={{
                            background: COLORS[index % COLORS.length],
                            color: 'white',
                            padding: '4px 10px',
                            borderRadius: '6px',
                            fontSize: '13px',
                            fontWeight: '600'
                          }}>{row.coin}</span>
                        </td>
                        <td style={{ padding: '12px 8px', textAlign: 'right', color: '#64748B' }}>
                          {formatUSD(row.currentPrice)}
                        </td>
                        <td style={{ padding: '8px 4px' }}>
                          <input
                            type="text"
                            value={row.quantity}
                            onChange={(e) => updateTableData(index, 'quantity', e.target.value)}
                            placeholder="0.00"
                            style={{
                              width: '100%',
                              maxWidth: '100px',
                              padding: '8px',
                              border: '1px solid #E2E8F0',
                              borderRadius: '8px',
                              textAlign: 'center',
                              fontSize: '14px'
                            }}
                          />
                        </td>
                        <td style={{ padding: '8px 4px' }}>
                          <input
                            type="text"
                            value={row.scenario1}
                            onChange={(e) => updateTableData(index, 'scenario1', e.target.value)}
                            placeholder="Gi√° KB1"
                            style={{
                              width: '100%',
                              maxWidth: '100px',
                              padding: '8px',
                              border: '1px solid #E2E8F0',
                              borderRadius: '8px',
                              textAlign: 'center',
                              fontSize: '14px'
                            }}
                          />
                        </td>
                        <td style={{ padding: '8px 4px' }}>
                          <input
                            type="text"
                            value={row.scenario2}
                            onChange={(e) => updateTableData(index, 'scenario2', e.target.value)}
                            placeholder="Gi√° KB2"
                            style={{
                              width: '100%',
                              maxWidth: '100px',
                              padding: '8px',
                              border: '1px solid #E2E8F0',
                              borderRadius: '8px',
                              textAlign: 'center',
                              fontSize: '14px'
                            }}
                          />
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>

              {error && (
                <p style={{ fontSize: '13px', color: '#DC2626', marginTop: '12px' }}>{error}</p>
              )}

              <div style={{ display: 'flex', gap: '12px', marginTop: '20px' }}>
                <button
                  onClick={() => setStep(0)}
                  style={{
                    flex: 1,
                    padding: '14px',
                    background: '#F1F5F9',
                    color: '#64748B',
                    border: 'none',
                    borderRadius: '12px',
                    fontSize: '16px',
                    fontWeight: '600',
                    cursor: 'pointer'
                  }}
                >
                  Quay l·∫°i
                </button>
                <button
                  onClick={handleAnalyze}
                  style={{
                    flex: 2,
                    padding: '14px',
                    background: '#0891B2',
                    color: 'white',
                    border: 'none',
                    borderRadius: '12px',
                    fontSize: '16px',
                    fontWeight: '600',
                    cursor: 'pointer'
                  }}
                >
                  Ph√¢n t√≠ch
                </button>
              </div>
            </div>
          )}

          {/* Step 2: K·∫øt qu·∫£ */}
          {step === 2 && results && (
            <div>
              {/* T·ªïng quan */}
              <div style={{
                background: 'white',
                borderRadius: '16px',
                padding: '24px',
                marginBottom: '16px',
                boxShadow: '0 2px 8px rgba(0,0,0,0.08)'
              }}>
                <h2 style={{ fontSize: '14px', fontWeight: '600', marginBottom: '16px', color: '#64748B', letterSpacing: '0.5px' }}>
                  DANH M·ª§C HI·ªÜN T·∫†I
                </h2>
                <div style={{ fontSize: '32px', fontWeight: 'bold', color: '#1E293B', marginBottom: '20px' }}>
                  {formatUSD(results.totalCurrent)}
                </div>

                {results.analysis.map((item, i) => (
                  <div key={item.coin} style={{
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'center',
                    padding: '12px 0',
                    borderBottom: i < results.analysis.length - 1 ? '1px solid #F1F5F9' : 'none'
                  }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                      <span style={{
                        background: COLORS[i % COLORS.length],
                        color: 'white',
                        padding: '4px 10px',
                        borderRadius: '6px',
                        fontSize: '12px',
                        fontWeight: '600'
                      }}>{item.coin}</span>
                      <span style={{ color: '#64748B', fontSize: '13px' }}>
                        {item.quantity} √ó {formatUSD(item.currentPrice)}
                      </span>
                    </div>
                    <div style={{ textAlign: 'right' }}>
                      <div style={{ fontWeight: '600', color: '#1E293B' }}>{formatUSD(item.currentValue)}</div>
                      <div style={{ fontSize: '12px', color: '#64748B' }}>
                        {((item.currentValue / results.totalCurrent) * 100).toFixed(1)}%
                      </div>
                    </div>
                  </div>
                ))}
              </div>

              {/* Line Chart - T·ªïng danh m·ª•c */}
              <div style={{
                background: 'white',
                borderRadius: '16px',
                padding: '24px',
                marginBottom: '16px',
                boxShadow: '0 2px 8px rgba(0,0,0,0.08)'
              }}>
                <h2 style={{ fontSize: '14px', fontWeight: '600', marginBottom: '20px', color: '#64748B', letterSpacing: '0.5px' }}>
                  BI·∫æN ƒê·ªòNG T·ªîNG DANH M·ª§C
                </h2>

                <div style={{ height: '250px', marginBottom: '20px' }}>
                  <TotalLineChart data={results} />
                </div>

                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '12px' }}>
                  <div style={{ background: '#F0FDFA', borderRadius: '12px', padding: '16px', textAlign: 'center' }}>
                    <div style={{ fontSize: '12px', color: '#0891B2', marginBottom: '4px' }}>Hi·ªán t·∫°i</div>
                    <div style={{ fontSize: '18px', fontWeight: 'bold', color: '#0891B2' }}>{formatUSD(results.totalCurrent)}</div>
                    <div style={{ fontSize: '13px', color: '#0891B2' }}>C∆° s·ªü</div>
                  </div>
                  <div style={{ background: results.totalS1Change >= 0 ? '#F0FDF4' : '#FEF2F2', borderRadius: '12px', padding: '16px', textAlign: 'center' }}>
                    <div style={{ fontSize: '12px', color: results.totalS1Change >= 0 ? '#16A34A' : '#DC2626', marginBottom: '4px' }}>K·ªãch b·∫£n 1</div>
                    <div style={{ fontSize: '18px', fontWeight: 'bold', color: results.totalS1Change >= 0 ? '#16A34A' : '#DC2626' }}>{formatUSD(results.totalS1)}</div>
                    <div style={{ fontSize: '13px', color: results.totalS1Change >= 0 ? '#16A34A' : '#DC2626' }}>{results.totalS1Change >= 0 ? '+' : ''}{results.totalS1Change.toFixed(1)}%</div>
                  </div>
                  <div style={{ background: results.totalS2Change >= 0 ? '#F0FDF4' : '#FEF2F2', borderRadius: '12px', padding: '16px', textAlign: 'center' }}>
                    <div style={{ fontSize: '12px', color: results.totalS2Change >= 0 ? '#16A34A' : '#DC2626', marginBottom: '4px' }}>K·ªãch b·∫£n 2</div>
                    <div style={{ fontSize: '18px', fontWeight: 'bold', color: results.totalS2Change >= 0 ? '#16A34A' : '#DC2626' }}>{formatUSD(results.totalS2)}</div>
                    <div style={{ fontSize: '13px', color: results.totalS2Change >= 0 ? '#16A34A' : '#DC2626' }}>{results.totalS2Change >= 0 ? '+' : ''}{results.totalS2Change.toFixed(1)}%</div>
                  </div>
                </div>
              </div>

              {/* Pie Charts - T·ª∑ tr·ªçng theo k·ªãch b·∫£n */}
              <div style={{
                background: 'white',
                borderRadius: '16px',
                padding: '24px',
                marginBottom: '16px',
                boxShadow: '0 2px 8px rgba(0,0,0,0.08)',
                overflow: 'hidden'
              }}>
                <h2 style={{ fontSize: '14px', fontWeight: '600', marginBottom: '24px', color: '#64748B', letterSpacing: '0.5px' }}>
                  T·ª∂ TR·ªåNG THEO K·ªäCH B·∫¢N
                </h2>

                <div style={{ 
                  display: 'flex', 
                  justifyContent: 'space-between',
                  gap: '16px',
                  flexWrap: 'wrap'
                }}>
                  <div style={{ flex: '1 1 200px', minWidth: '200px', maxWidth: '250px' }}>
                    <PieChart data={results.weightsCurrent} title="Hi·ªán t·∫°i" titleColor="#0891B2" />
                  </div>
                  <div style={{ flex: '1 1 200px', minWidth: '200px', maxWidth: '250px' }}>
                    <PieChart data={results.weightsS1} title="K·ªãch b·∫£n 1" titleColor="#DC2626" />
                  </div>
                  <div style={{ flex: '1 1 200px', minWidth: '200px', maxWidth: '250px' }}>
                    <PieChart data={results.weightsS2} title="K·ªãch b·∫£n 2" titleColor="#16A34A" />
                  </div>
                </div>

                {/* Legend */}
                <div style={{ 
                  display: 'flex', 
                  justifyContent: 'center', 
                  gap: '20px', 
                  marginTop: '24px', 
                  flexWrap: 'wrap',
                  padding: '16px',
                  background: '#F8FAFC',
                  borderRadius: '12px'
                }}>
                  {results.analysis.map((item, i) => (
                    <div key={item.coin} style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                      <div style={{ 
                        width: '14px', 
                        height: '14px', 
                        borderRadius: '4px', 
                        background: COLORS[i % COLORS.length],
                        boxShadow: '0 1px 3px rgba(0,0,0,0.2)'
                      }} />
                      <span style={{ fontSize: '13px', fontWeight: '600', color: '#334155' }}>{item.coin}</span>
                    </div>
                  ))}
                </div>
              </div>

              {/* Column Chart - Bi·∫øn ƒë·ªông t·ª´ng coin */}
              <div style={{
                background: 'white',
                borderRadius: '16px',
                padding: '24px',
                marginBottom: '16px',
                boxShadow: '0 2px 8px rgba(0,0,0,0.08)'
              }}>
                <h2 style={{ fontSize: '14px', fontWeight: '600', marginBottom: '20px', color: '#64748B', letterSpacing: '0.5px' }}>
                  BI·∫æN ƒê·ªòNG T·ª™NG COIN
                </h2>

                <div style={{ height: '300px', marginBottom: '20px' }}>
                  <CoinColumnChart analysis={results.analysis} />
                </div>

                {/* B·∫£ng chi ti·∫øt */}
                <div style={{ overflowX: 'auto' }}>
                  <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: '13px' }}>
                    <thead>
                      <tr style={{ background: '#F8FAFC' }}>
                        <th style={{ padding: '10px 8px', textAlign: 'left', fontWeight: '600', color: '#64748B' }}>Coin</th>
                        <th style={{ padding: '10px 8px', textAlign: 'right', fontWeight: '600', color: '#0891B2' }}>Hi·ªán t·∫°i</th>
                        <th style={{ padding: '10px 8px', textAlign: 'right', fontWeight: '600', color: '#DC2626' }}>KB1</th>
                        <th style={{ padding: '10px 8px', textAlign: 'right', fontWeight: '600', color: '#16A34A' }}>KB2</th>
                      </tr>
                    </thead>
                    <tbody>
                      {results.analysis.map((item, i) => (
                        <tr key={item.coin} style={{ borderBottom: '1px solid #F1F5F9' }}>
                          <td style={{ padding: '10px 8px' }}>
                            <span style={{
                              background: COLORS[i % COLORS.length],
                              color: 'white',
                              padding: '2px 8px',
                              borderRadius: '4px',
                              fontSize: '12px',
                              fontWeight: '600'
                            }}>{item.coin}</span>
                          </td>
                          <td style={{ padding: '10px 8px', textAlign: 'right' }}>
                            <div style={{ fontWeight: '600' }}>{formatUSD(item.currentValue)}</div>
                          </td>
                          <td style={{ padding: '10px 8px', textAlign: 'right' }}>
                            <div style={{ color: item.scenario1Change >= 0 ? '#16A34A' : '#DC2626' }}>{formatUSD(item.scenario1Value)}</div>
                            <div style={{ fontSize: '11px', color: item.scenario1Change >= 0 ? '#16A34A' : '#DC2626' }}>({item.scenario1Change >= 0 ? '+' : ''}{item.scenario1Change.toFixed(0)}%)</div>
                          </td>
                          <td style={{ padding: '10px 8px', textAlign: 'right' }}>
                            <div style={{ color: item.scenario2Change >= 0 ? '#16A34A' : '#DC2626' }}>{formatUSD(item.scenario2Value)}</div>
                            <div style={{ fontSize: '11px', color: item.scenario2Change >= 0 ? '#16A34A' : '#DC2626' }}>({item.scenario2Change >= 0 ? '+' : ''}{item.scenario2Change.toFixed(0)}%)</div>
                          </td>
                        </tr>
                      ))}
                      <tr style={{ background: '#F8FAFC', fontWeight: '600' }}>
                        <td style={{ padding: '10px 8px' }}>T·ªîNG</td>
                        <td style={{ padding: '10px 8px', textAlign: 'right', color: '#0891B2' }}>{formatUSD(results.totalCurrent)}</td>
                        <td style={{ padding: '10px 8px', textAlign: 'right', color: results.totalS1Change >= 0 ? '#16A34A' : '#DC2626' }}>{formatUSD(results.totalS1)}</td>
                        <td style={{ padding: '10px 8px', textAlign: 'right', color: results.totalS2Change >= 0 ? '#16A34A' : '#DC2626' }}>{formatUSD(results.totalS2)}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              {/* So s√°nh 2 k·ªãch b·∫£n */}
              <div style={{
                background: 'white',
                borderRadius: '16px',
                padding: '24px',
                marginBottom: '16px',
                boxShadow: '0 2px 8px rgba(0,0,0,0.08)'
              }}>
                <h2 style={{ fontSize: '14px', fontWeight: '600', marginBottom: '16px', color: '#64748B', letterSpacing: '0.5px' }}>
                  SO S√ÅNH 2 K·ªäCH B·∫¢N
                </h2>

                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '12px' }}>
                  <div style={{
                    background: results.totalS1Change >= 0 ? '#F0FDF4' : '#FEF2F2',
                    borderRadius: '12px',
                    padding: '20px',
                    textAlign: 'center'
                  }}>
                    <div style={{ fontSize: '12px', color: '#64748B', marginBottom: '8px' }}>K·ªãch b·∫£n 1</div>
                    <div style={{ fontSize: '24px', fontWeight: 'bold', color: results.totalS1Change >= 0 ? '#16A34A' : '#DC2626' }}>
                      {results.totalS1Change >= 0 ? '+' : ''}{formatUSD(results.totalS1 - results.totalCurrent)}
                    </div>
                    <div style={{ fontSize: '13px', color: results.totalS1Change >= 0 ? '#16A34A' : '#DC2626', marginTop: '4px' }}>
                      {results.totalS1Change >= 0 ? '+' : ''}{results.totalS1Change.toFixed(1)}%
                    </div>
                  </div>

                  <div style={{
                    background: results.totalS2Change >= 0 ? '#F0FDF4' : '#FEF2F2',
                    borderRadius: '12px',
                    padding: '20px',
                    textAlign: 'center'
                  }}>
                    <div style={{ fontSize: '12px', color: '#64748B', marginBottom: '8px' }}>K·ªãch b·∫£n 2</div>
                    <div style={{ fontSize: '24px', fontWeight: 'bold', color: results.totalS2Change >= 0 ? '#16A34A' : '#DC2626' }}>
                      {results.totalS2Change >= 0 ? '+' : ''}{formatUSD(results.totalS2 - results.totalCurrent)}
                    </div>
                    <div style={{ fontSize: '13px', color: results.totalS2Change >= 0 ? '#16A34A' : '#DC2626', marginTop: '4px' }}>
                      {results.totalS2Change >= 0 ? '+' : ''}{results.totalS2Change.toFixed(1)}%
                    </div>
                  </div>

                  <div style={{
                    background: '#F8FAFC',
                    borderRadius: '12px',
                    padding: '20px',
                    textAlign: 'center'
                  }}>
                    <div style={{ fontSize: '12px', color: '#64748B', marginBottom: '8px' }}>Ch√™nh l·ªách</div>
                    <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#1E293B' }}>
                      {formatUSD(Math.abs(results.totalS2 - results.totalS1))}
                    </div>
                    <div style={{ fontSize: '13px', color: '#64748B', marginTop: '4px' }}>
                      {Math.abs(results.totalS2Change - results.totalS1Change).toFixed(1)}%
                    </div>
                  </div>
                </div>
              </div>

              {/* N√∫t ƒëi·ªÅu h∆∞·ªõng */}
              <div style={{ display: 'flex', gap: '12px' }}>
                <button
                  onClick={() => setStep(1)}
                  style={{
                    flex: 1,
                    padding: '16px',
                    background: '#F1F5F9',
                    color: '#64748B',
                    border: 'none',
                    borderRadius: '12px',
                    fontSize: '16px',
                    fontWeight: '600',
                    cursor: 'pointer'
                  }}
                >
                  ‚Üê S·ª≠a d·ªØ li·ªáu
                </button>
                <button
                  onClick={handleReset}
                  style={{
                    flex: 1,
                    padding: '16px',
                    background: '#1E293B',
                    color: 'white',
                    border: 'none',
                    borderRadius: '12px',
                    fontSize: '16px',
                    fontWeight: '600',
                    cursor: 'pointer'
                  }}
                >
                  Ph√¢n t√≠ch m·ªõi
                </button>
              </div>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
